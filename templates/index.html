<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galax Video</title>
     <!-- Compiled and minified CSS -->
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

     <!-- Compiled and minified JavaScript -->
     <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
     <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
         
     
     <style>
        .row {
          background-color: #0A0C1A;
          border: none !important;
        }
        
        .categoria-titulo {
          color: #ffffff; /* Substitua pela cor desejada */
          font-size: 20px; /* Ajuste o tamanho */
          font-weight: bold; /* Deixa o texto em negrito */
          margin: 10px 0; /* Adiciona espa√ßamento acima e abaixo */
          margin-left: 10px;
        }

        .nav-extended {
          background-color: #0c0a33;
          padding: 0 !important;
          margin: 0 !important;
          border: none !important;

        }
        
        .nav-content {
          position: relative;  
          display: flex;
          justify-content: space-between;
          background-color: #0f0838;
          padding: 0 !important;
          margin: 0 !important;
          height: 50px;
          border: none !important;
        }
        
        .search-container {
            position: relative;
            top: 0px;
            position: relative;
            display: flex;
            align-items: center;
            height: 50px;
        }

        #search-input {
            color:white;
            margin: 0;
            display: none;
            width: 400px;
            height: 30px;
            padding: 6px;
            border: 1px solid #ccc;
            border-radius: 5px;
            transition: transform 0.3s ease;
        }
        .search-container.active #search-input {
            width: 200px;
            opacity: 0;
            right: auto;
            left: 0;/* üîπ Move o input para a esquerda */
        }

        /* üîπ Move o bot√£o tamb√©m */
        .search-container.active #search-btn {
            transform: translateX(-210px);
        }

        #search-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px; /* üîπ Ajuste conforme necess√°rio */
            height: 40px;
            transition: transform 0.3s ease;
            background: transparent;
            border: none; 
        }
        #search-btn i{
            color:white;
        }
        .nav-header img {
          width: auto; /* Escolha a largura desejada */
          height: auto; /* Mant√©m a propor√ß√£o da imagem */
          margin: 0 auto;
          object-fit: contain;
        }

        .card{
          min-width: 300px; 
          max-width: 320px; /* Deixa os cards menores */
          height: auto;
            background-color:#040336;
        }
        .card.hoverable:hover {
          box-shadow: 0 8px 16px rgba(255, 255, 255, 0.3) !important; /* Sombra mais clara */
          transform: scale(1.02); /* Pequeno efeito de crescimento */
          transition: all 0.3s ease-in-out;
        }
    
        .card-title {
        color: #ffffff;
        font-size: medium;
        overflow: hidden;
        text-overflow: ellipsis;
        -webkit-box-orient: vertical;
        line-height: 1.4;
        height: 2.8em; 
        white-space: normal;
        }

        /* Cor da nota dos filmes */
        .valign-wrapper {
            color: #ffffff; 
        }

        /* Cor do texto da sinopse */
        .card-content p {
            color: #ffffff;
            overflow: hidden;
        }
        body {
        background-color: #0A0C1A; /* Alterar para a cor desejada */
        }
        .tab a.active{
          background-color: transparent;   
          border-bottom: solid 2px #fff ;
        }
       
        .tabs .tab a:focus,
        .tabs .tab a:focus.active {
            border-bottom: 2px solid white !important;
          background-color: transparent !important;      
        }
        .row-container {
        position: relative;
        width: 100%;
        margin: 20px 0;
       }

    .rowContent {
        display: flex;
        align-items: center;
        position: relative;
        }
    .row-container {
          min-height: 680px;
      }
    .slider {
      min-height: 680px;
        display: flex;
        gap: 10px;
        overflow-x: auto;
        scroll-behavior: smooth;
        white-space: nowrap;
        padding: 10px;
        }

    .slider::-webkit-scrollbar {
        display: none;
        }

    .slider-arrow {
        position: absolute;
        background-color: rgba(0, 0, 0, 0.5);
        color: white;
        border: none;
        padding: 10px;
        cursor: pointer;
        z-index: 10;
    }

    .slider-arrow.left {
        left: 0;
    }

    .slider-arrow.right {
        right: 0;
    }

    .slider-arrow i {
        font-size: 24px;
    }
    .expand-container {
    position: absolute;
    bottom: 10px;
    right: 25px; 
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    }

    .expand-btn {
            position: relative;
    }
    
    .modal {
        display: none; /* Oculta por padr√£o */
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        max-height: 100%;
        background-color: rgba(0, 0, 0, 0.8); /* Fundo semitransparente */
        z-index: 1000; /* Fica acima de outros elementos */
        justify-content: center;
        align-items: center;
        overflow: auto;
    }

    /* Conte√∫do do modal */
    .modal-content {
        position: relative;
        background: #222;
        color: #fff;
        border-radius: 8px;
        padding: 20px;
        width: 50%;
        max-height: 95%;
        overflow-y: auto; /* Permite rolagem se necess√°rio */
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        overflow: hidden;
        overflow-y: scroll; 
    }
    .modal-content::-webkit-scrollbar {
    display: none; /* üîπ Oculta a barra de rolagem */
    }


    /* Bot√£o de fechar */
    .close-button {
        position: absolute;
        top: 10px;
        right: 20px;
        font-size: 24px;
        cursor: pointer;
        color: #fff;
    }
    .video-container {
    width: 100%;
    height: 0;
    padding-bottom: 56.25%; /* Propor√ß√£o 16:9 */
    position: relative;
    }

    .video-container iframe {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border: none;
    }
    .info-container {
    display: flex;
    flex-direction: column; /* Garante que as informa√ß√µes fiquem abaixo do ano */
    left:5px;
    }

    .info-container p {
        margin-bottom: 5px;
        display: flex;
        align-items: center; /* Alinha o √≠cone HQ ao lado do texto */
    }

    .info-container .material-icons {
        margin-left: 10px; /* Adiciona o espa√ßo entre o ano e o √≠cone */
        font-size: 40px; /* Aumenta o tamanho para m√©dio */
    }
    .btn-container{
        display: flex;
        justify-content: flex-end;
        gap: 10px;
    }
    
    #favoritos-tab {
    display: flex;
    flex-wrap: wrap;
    gap: 10px; /* Espa√ßo entre os filmes */
    justify-content: left; 
    padding-left: 10px; 
    }

    #favoritos-tab .card {
    width: 200px; 
    }
    #categoria-tab {
    display: flex;
    flex-wrap: wrap;
    gap: 10px; /*Espa√ßamento entre os filmes */
    justify-content: left; 
    padding-left: 10px; 
    }
    #categoria-tab .card {
    width: 200px;
    
    }   
    .select-container {
    left: 10px ;   
    position: relative;
    width: 250px;
    }
    .select-container {
    position: relative;
    width: 250px;
    }

    .select-container::after {
        content: "expand_more";
        font-family: "Material Icons";
        position: absolute;
        right: 12px;
        top: 50%;
        transform: translateY(-50%);
        color: white;
        pointer-events: none; /* üîπ Impede que o √≠cone atrapalhe o clique */
    }
    #selecionarGenero:hover {
    background-color: #333;
    transition: 0.3s;
    }
    #selecionarGenero {
        width: 100%;
        padding: 8px 12px;
        font-size: 16px;
        border-radius: 5px;
        background-color: #222;
        color: white;
        border: 1px solid #444;
        cursor: pointer;
        appearance: none; /* Remove estilo padr√£o */
        text-align: center;
    }

    #selecionarGenero option {
        padding: 10px;
    }

    /* Simula um menu dropdown de m√∫ltiplas colunas */
    #selecionarGenero[multiple] {
        height: auto;
        display: block;
        column-count: 3; /* üîπ Divide as op√ß√µes em tr√™s colunas */
        overflow-y: auto;
        max-height: 200px;
    }
    #selecionarGenero {
    display: block !important; /* For√ßa a exibi√ß√£o */
    }
    
    .classificacao-indicativa {
    position: absolute;
    top: 5px; /* Alinha ao topo no mesmo n√≠vel do bot√£o de cora√ß√£o */
    left: 10px; /* Posiciona no lado esquerdo */
    width: 50px; /* Mant√©m um tamanho proporcional */
    height: 50px;
    object-fit: contain; /* Evita distor√ß√µes */
    z-index: 2; /* Garante que fique acima do p√¥ster */
    }
    .classificacao-indicativa-modal{
    position: relative;
    width: 50px; /* Mant√©m um tamanho proporcional */
    height: 50px;
    }
    #filmes-encontrados {
    display: flex;
    flex-wrap: wrap; /* üîπ Permite que os filmes quebrem de linha se necess√°rio */
    gap: 10px; /* üîπ Adiciona espa√ßamento entre os cards */
    justify-content: left; /* üîπ Centraliza os filmes na tela */
    padding-left: 10px;
}
    #resultado-pesquisa {
        color: white; 
    }
    .edit-container {
    display: none; /* üîπ Oculto ao carregar a p√°gina */
    flex-direction: column; /* üîπ Organiza os elementos na vertical */
    gap: 15px; /* üîπ Espa√ßo entre os campos */
    background: #222;
    padding: 20px;
    border-radius: 10px;
    width: 100%;
    }
/* üîπ Espa√ßamento entre labels e inputs */
.edit-container label {
    display: block;
    color: #ddd;
    font-weight: bold;
    margin-top: 15px;
    font-size: 16px;
}

/* üîπ Formata√ß√£o dos campos de entrada */
.edit-container input,
.edit-container textarea {
    width: 100%;
    padding: 10px;
    margin-top: 5px;
    border-radius: 5px;
    border: none;
    background: #333;
    color: #fff;
    font-size: 14px;
}

/* üîπ Ajuste do textarea para sinopse */
.edit-container textarea {
    height: 80px;
    resize: none;
}

/* üîπ Espa√ßamento dos bot√µes */
.edit-container .btn-save,
.edit-container .btn-cancel {
    margin-top: 20px;
    padding: 10px;
    border: none;
    cursor: pointer;
    width: 100%;
    font-size: 16px;
}

/* üîπ Cores dos bot√µes */
.btn-save {
    background: #1e88e5;
    color: white;
}
.btn-save:hover {
    background: #1565c0; /* üîπ Tom mais escuro ao passar o mouse */
}
.btn-cancel:hover {
    background: #b71c1c; /* üîπ Tom mais escuro ao passar o mouse */
}
.btn-cancel {
    background: #d32f2f;
    color: white;
}
    </style>
</head>
<body>
    
  <nav class="nav-extended">
    <div class="nav-wrapper">
        <ul id="nav-mobile" class="right">
            <li><a href="/menu">Cat√°logo</a></li>
            <li><a href="/cadastrarfilme">Cadastrar</a></li>
            <li><a href="/">Sair</a></li>
        </ul>
    </div>
    <div class="nav-header center">
        <img src="static/images/logo_galax.png" alt="Galax Video Logo">
</div>    
    <div class="nav-content">
      <ul class="tabs tabs-transparent">
        <li class="tab"><a href="#todos">Todos</a></li>
        <li class="tab"><a href="#favorito">Favoritos</a></li>
        <li class="tab"><a href="#categorias">Categorias</a></li>
      </ul>
      <div class="search-container">
        <button id="search-btn">
            <i class="material-icons">search</i>
        </button>
        <input type="text" id="search-input" placeholder="Encontrar Filmes e S√©ries" />
    </div>
    </div>
  </nav>
  <div id="todos" class="tab-content">
    <div class="row-container">
        <h3 class="categoria-titulo">Lan√ßamentos</h3>
        <div class="rowContent">
            <button class="slider-arrow left" onclick="scrollSlider('slider-lancamentos', 'left')">
                <i class="material-icons">chevron_left</i>
            </button>

            <div class="slider" id="slider-lancamentos">
                <!-- Filmes ser√£o adicionados aqui dinamicamente -->
            </div>

            <button class="slider-arrow right" onclick="scrollSlider('slider-lancamentos', 'right')">
                <i class="material-icons">chevron_right</i>
            </button>
        </div>
    </div>
    <div class="row-container">
        <h3 class="categoria-titulo">A√ß√£o</h3>
        <div class="rowContent">
            <button class="slider-arrow left" onclick="scrollSlider('slider-acao', 'left')">
                <i class="material-icons">chevron_left</i>
            </button>

            <div class="slider" id="slider-acao">
                <!-- Filmes ser√£o adicionados aqui dinamicamente -->
            </div>

            <button class="slider-arrow right" onclick="scrollSlider('slider-acao', 'right')">
                <i class="material-icons">chevron_right</i>
            </button>
        </div>
    </div>
    <div class="row-container">
        <h3 class="categoria-titulo">Com√©dia</h3>
        <div class="rowContent">
            <button class="slider-arrow left" onclick="scrollSlider('slider-comedia', 'left')">
                <i class="material-icons">chevron_left</i>
            </button>

            <div class="slider" id="slider-comedia">
                <!-- Filmes ser√£o adicionados aqui dinamicamente -->
            </div>

            <button class="slider-arrow right" onclick="scrollSlider('slider-comedia', 'right')">
                <i class="material-icons">chevron_right</i>
            </button>
        </div>
    </div>
    <div class="row-container">
        <h3 class="categoria-titulo">Aventura</h3>
        <div class="rowContent">
            <button class="slider-arrow left" onclick="scrollSlider('slider-aventura', 'left')">
                <i class="material-icons">chevron_left</i>
            </button>

            <div class="slider" id="slider-aventura">
                <!-- Filmes ser√£o adicionados aqui dinamicamente -->
            </div>

            <button class="slider-arrow right" onclick="scrollSlider('slider-aventura', 'right')">
                <i class="material-icons">chevron_right</i>
            </button>
        </div>
    </div>
    <div class="row-container">
        <h3 class="categoria-titulo">Drama</h3>
        <div class="rowContent">
            <button class="slider-arrow left" onclick="scrollSlider('slider-drama', 'left')">
                <i class="material-icons">chevron_left</i>
            </button>

            <div class="slider" id="slider-drama">
                <!-- Filmes ser√£o adicionados aqui dinamicamente -->
            </div>

            <button class="slider-arrow right" onclick="scrollSlider('slider-drama', 'right')">
                <i class="material-icons">chevron_right</i>
            </button>
        </div>
    </div>
    <div class="row-container">
        <h3 class="categoria-titulo">Fic√ß√£o Cientifica</h3>
        <div class="rowContent">
            <button class="slider-arrow left" onclick="scrollSlider('slider-ficcao', 'left')">
                <i class="material-icons">chevron_left</i>
            </button>

            <div class="slider" id="slider-ficcao">
                <!-- Filmes ser√£o adicionados aqui dinamicamente -->
            </div>

            <button class="slider-arrow right" onclick="scrollSlider('slider-ficcao', 'right')">
                <i class="material-icons">chevron_right</i>
            </button>
        </div>
    </div>
    <div class="row-container">
        <h3 class="categoria-titulo">Fantasia</h3>
        <div class="rowContent">
            <button class="slider-arrow left" onclick="scrollSlider('slider-fantasia', 'left')">
                <i class="material-icons">chevron_left</i>
            </button>

            <div class="slider" id="slider-fantasia">
                <!-- Filmes ser√£o adicionados aqui dinamicamente -->
            </div>

            <button class="slider-arrow right" onclick="scrollSlider('slider-fantasia', 'right')">
                <i class="material-icons">chevron_right</i>
            </button>
        </div>
    </div>
    <div class="row-container">
        <h3 class="categoria-titulo">Anima√ß√£o</h3>
        <div class="rowContent">
            <button class="slider-arrow left" onclick="scrollSlider('slider-animacao', 'left')">
                <i class="material-icons">chevron_left</i>
            </button>

            <div class="slider" id="slider-animacao">
                <!-- Filmes ser√£o adicionados aqui dinamicamente -->
            </div>

            <button class="slider-arrow right" onclick="scrollSlider('slider-animacao', 'right')">
                <i class="material-icons">chevron_right</i>
            </button>
        </div>
    </div>
    <div class="row-container">
        <h3 class="categoria-titulo">Terror</h3>
        <div class="rowContent">
            <button class="slider-arrow left" onclick="scrollSlider('slider-terror', 'left')">
                <i class="material-icons">chevron_left</i>
            </button>

            <div class="slider" id="slider-terror">
                <!-- Filmes ser√£o adicionados aqui dinamicamente -->
            </div>

            <button class="slider-arrow right" onclick="scrollSlider('slider-terror', 'right')">
                <i class="material-icons">chevron_right</i>
            </button>
        </div>
    </div>
    <div class="row-container">
        <h3 class="categoria-titulo">Suspense</h3>
        <div class="rowContent">
            <button class="slider-arrow left" onclick="scrollSlider('slider-suspense', 'left')">
                <i class="material-icons">chevron_left</i>
            </button>

            <div class="slider" id="slider-suspense">
                <!-- Filmes ser√£o adicionados aqui dinamicamente -->
            </div>

            <button class="slider-arrow right" onclick="scrollSlider('slider-suspense', 'right')">
                <i class="material-icons">chevron_right</i>
            </button>
        </div>
    </div>
    <div class="row-container">
        <h3 class="categoria-titulo">Romance</h3>
        <div class="rowContent">
            <button class="slider-arrow left" onclick="scrollSlider('slider-romance', 'left')">
                <i class="material-icons">chevron_left</i>
            </button>

            <div class="slider" id="slider-romance">
                <!-- Filmes ser√£o adicionados aqui dinamicamente -->
            </div>

            <button class="slider-arrow right" onclick="scrollSlider('slider-romance', 'right')">
                <i class="material-icons">chevron_right</i>
            </button>
        </div>
    </div>
</div>
<div id="favorito" class="tab-content" style="display: none;">
    <div class="row-container">
    <h3 class="categoria-titulo">Meus Favoritos</h3>
        <div id="favoritos-tab" class="rowContent">
        <!-- Os filmes favoritos aparecer√£o aqui -->
        </div>
    </div>
</div>
<div id="categorias" class="tab-content" style="display: none;">
    <h3 class="categoria-titulo">Filmes por G√™nero</h3> 
    <div class="select-container">
        <select id="selecionarGenero" size="1">
            <option value="" disabled selected>Escolha um g√™nero</option>
            <option value="acao">A√ß√£o</option>
            <option value="comedia">Com√©dia</option>
            <option value="terror">Terror</option>
            <option value="drama">Drama</option>
            <option value="Fic√ß√£o Cientifica">Fic√ß√£o Cientifica</option>
            <option value="fantasia">Fantasia</option>
            <option value="romance">Romance</option>
            <option value="documentario">Document√°rio</option>
            <option value="animacao">Anima√ß√£o</option>
        </select>
    </div>
    <div class="row-container">
        <div id="categoria-tab" class="rowContent"></div>
    </div>
</div>
<div id="resultado-pesquisa" class="row-container" style="display: none;">
    <h3>Buscar por "<span id="termo-busca"></span>"</h3>
    <div id="filmes-encontrados" class="rowContent">

    </div>
</div>
<div id="modal" class="modal" data-id="${filme.idFilme}">
    <div class="modal-content">
        <span class="close-button" onclick="closeModal()">&times;</span>
        <h2 id="modal-title">T√≠tulo do Filme</h2>
        <div class="video-container">
            <iframe id="modal-trailer" width="400" height="225" 
                src="" 
                title="Trailer do Filme" 
                frameborder="0" 
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                allowfullscreen>
            </iframe>
        </div>
        <div class="info-container">
            <p><span id="modal-year" style="font-size: 20px;"></span>
                <i class="material-icons">hd</i>
            </p>
            <i id="modal-rating" class="classificacao-indicativa-modal"></i>
            <p><strong>G√™neros:</strong> <span id="modal-genres"></span></p>
        </div>
        <p><strong>Sinopse:</strong> <span id="modal-description"></span></p>
        <div class="btn-container">
            <button id="btn-edit" class="btn-edit btn-floating waves-effect waves-light blue">   
                <i class="material-icons">edit</i>
            </button>
            <button id="btn-delete" class="btn-delete btn-floating waves-effect waves-light red darken-3" data-id="${filme.idFilme}">   
                <i class="material-icons">delete</i>
            </button>
        </div>
        <div id="edit-container" class="edit-container">
            <h3>Editar Filme</h3>
            <label>T√≠tulo:</label>
            <input type="text" id="edit-title">
        
            <label>Ano de Lan√ßamento:</label>
            <input type="number" id="edit-year">
        
            <label>G√™nero:</label>
            <input type="text" id="edit-genres">
        
            <label>Sinopse:</label>
            <textarea id="edit-description"></textarea>
        
            <button id="save-edit" class="btn-save">Salvar</button>
            <button id="cancel-edit" class="btn-cancel">Cancelar</button>
        </div>
        
    </div>
</div>
  <script>
    const usuarioId = localStorage.getItem("usuarioId");
    if (!usuarioId) {
            window.location.href = "/"; //  Redireciona para a p√°gina de login se n√£o estiver autenticado
        }
    const isAdmin = localStorage.getItem("isAdmin") === "true";
    if (!isAdmin) {
    document.querySelector('a[href="/cadastrarfilme"]').style.display = "none";
    }
    // Esconde bot√µes de editar/apagar nos cards/modal
    function esconderBotoesAdmin() {
        if (!isAdmin) {
        document.querySelectorAll("#btn-edit, .btn-delete").forEach(btn => btn.style.display = "none");
        }
    }
    esconderBotoesAdmin();
    console.log("Usu√°rio logado com ID:", usuarioId);
      function carregarFilmes() {
    fetch('http://localhost:5000/filmes') 
        .then(response => response.json())
        .then(filmes => {
            const sliderLancamentos = document.getElementById('slider-lancamentos');
            const sliderAcao = document.getElementById('slider-acao');
            const sliderComedia = document.getElementById('slider-comedia');
            const sliderAventura = document.getElementById('slider-aventura');
            const sliderDrama = document.getElementById('slider-Drama');
            const sliderFiccao = document.getElementById('slider-ficcao');
            const sliderAnimacao = document.getElementById('slider-animacao');
            const sliderTerror = document.getElementById('slider-terror');
            const sliderSuspense = document.getElementById('slider-suspense');
            const sliderRomance = document.getElementById('slider-romance');
            const sliderFantasia = document.getElementById('slider-fantasia');



            if (!sliderLancamentos) {
                console.error('Erro: O slider de a√ß√£o n√£o foi encontrado no DOM.');
                return;
            }

            filmes.forEach(filme => {
                const caminhoClassificacao = carregarClassificacao(filme.Classifica√ß√£o);
                const cardHTML = `
                    <div class="col s2">
                        <div class="card hoverable"  data-id="${filme.idFilme}">
                            <div class="card-image">
                                <img src="${filme.imagem}" alt="${filme.nomeFilme}">
                                <button class="btn-fav btn-floating halfway-fab waves-effect waves-light red" data-id="${filme.idFilme}">
                                    <i class="material-icons">favorite_border</i>
                                </button>
                                <i class="classificacao-indicativa" style="background-image: url('${caminhoClassificacao}');"></i>
                            </div>
                            <div class="card-content">
                                <span class="card-title">${filme.nomeFilme || 'T√≠tulo n√£o encontrado'}</span>
                                <p class="valign-wrapper">
                                    <i class="material-icons amber-text">star</i> ${filme.nota || 'N/A'}
                                </p>
                                <p class="valign-wrapper">
                                    <i class="material-icons">calendar_today</i> ${filme.AnoLanc || 'Ano n√£o dispon√≠vel'}
                                </p>
                                <div class="expand-container">
                                <a class="btn-floating waves-effect waves-light blue expand-btn" onclick='openModal(${filme.idFilme})'>
                                    <i class="material-icons">expand_more</i>
                                </a>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                    
                  // Adiciona TODOS os filmes ao slider de lan√ßamentos
                  sliderLancamentos.insertAdjacentHTML('beforeend', cardHTML);

                  // Adiciona o filme ao slider correspondente √† sua categoria
                  if (filme.Categoria.includes('A√ß√£o') && sliderAcao) {
                      sliderAcao.insertAdjacentHTML('beforeend', cardHTML);
                  }

                  if (filme.Categoria.includes('Com√©dia') && sliderComedia) {
                      sliderComedia.insertAdjacentHTML('beforeend', cardHTML);
                  }

                  if (filme.Categoria.includes('Aventura') && sliderAventura) {
                      sliderAventura.insertAdjacentHTML('beforeend', cardHTML);
                  }

                  if (filme.Categoria.includes('Drama') && sliderDrama) {
                      sliderDrama.insertAdjacentHTML('beforeend', cardHTML);
                  }

                  if (filme.Categoria.includes('Fic√ß√£o Cientifica') && sliderFiccao) {
                      sliderFiccao.insertAdjacentHTML('beforeend', cardHTML);
                  }

                  if (filme.Categoria.includes('Anima√ß√£o') && sliderAnimacao) {
                      sliderAnimacao.insertAdjacentHTML('beforeend', cardHTML);
                  }

                  if (filme.Categoria.includes('Terror') && sliderTerror) {
                      sliderTerror.insertAdjacentHTML('beforeend', cardHTML);
                  }

                  if (filme.Categoria.includes('Suspense') && sliderSuspense) {
                      sliderSuspense.insertAdjacentHTML('beforeend', cardHTML);
                  }
                  
                  if (filme.Categoria.includes('Fantasia') && sliderFantasia) {
                      sliderFantasia.insertAdjacentHTML('beforeend', cardHTML);
                  }

                  if (filme.Categoria.includes('Romance') && sliderRomance) {
                      sliderRomance.insertAdjacentHTML('beforeend', cardHTML);
                  }
                  

            });
        })
        .catch(error => console.error('Erro ao buscar filmes:', error));
        }
        function carregarClassificacao(classificacao) {
    
        const diretorio = "/static/images/";
        
        // Constr√≥i o caminho da imagem com base na classifica√ß√£o
        const caminhoImagem = `${diretorio}classificacao${classificacao}.png`;

        return caminhoImagem; // Retorna o caminho completo
        }
        document.querySelectorAll(".tabs a").forEach(tab => {
        tab.addEventListener("click", (event) => {
            event.preventDefault(); // Evita comportamento padr√£o

            // Esconde todo o conte√∫do das abas
            document.querySelectorAll(".tab-content").forEach(content => content.style.display = "none");

            // Ativa a aba selecionada
            const target = event.target.getAttribute("href");
            document.querySelector(target).style.display = "block";

            // Esconde a aba de todos os filmes e carrega os dados espec√≠ficos da aba selecionada
            document.getElementById("todos").style.display = "none";

            if (target === "#favorito") {
                carregarFavoritos(); // üîπ Carrega apenas os filmes favoritados
            } else if (target !== "#categorias") {
            document.getElementById("todos").style.display = "block"; // Exibe os filmes gerais novamente
            }

        });
         });
        async function carregarFavoritos() {
        const usuarioId = localStorage.getItem("usuarioId");

        if (!usuarioId) {
            console.error("Usu√°rio n√£o logado ou ID n√£o dispon√≠vel.");
            return;
        }

        try {
            const response = await fetch("/favoritos-usuario", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ usuarioId })
            });

            const filmesFavoritos = await response.json();
            console.log("Filmes favoritos carregados:", filmesFavoritos);

            const favoritosContainer = document.getElementById("favoritos-tab");
            favoritosContainer.innerHTML = ""; // üîπ Limpa antes de adicionar os filmes favoritos

            filmesFavoritos.forEach(filme => {
                const caminhoClassificacao = carregarClassificacao(filme.Classifica√ß√£o);
                const cardHTML = `
                    <div class="col s2">
                        <div class="card hoverable" data-id="${filme.idFilme}">
                            <div class="card-image">
                                <img src="${filme.imagem}" alt="${filme.nomeFilme}">
                                <button class="btn-fav btn-floating halfway-fab waves-effect waves-light red" data-id="${filme.idFilme}">
                                    <i class="material-icons">favorite</i>
                                </button>
                                <i class="classificacao-indicativa" style="background-image: url('${caminhoClassificacao}');"></i>
                            </div>
                            <div class="card-content">
                                <span class="card-title">${filme.nomeFilme || 'T√≠tulo n√£o encontrado'}</span>
                                <p class="valign-wrapper">
                                    <i class="material-icons amber-text">star</i> ${filme.nota || 'N/A'}
                                </p>
                                <p class="valign-wrapper">
                                    <i class="material-icons">calendar_today</i> ${filme.AnoLanc || 'Ano n√£o dispon√≠vel'}
                                </p>
                                <div class="expand-container">
                                <a class="btn-floating waves-effect waves-light blue expand-btn" onclick='openModal(${filme.idFilme})'>
                                    <i class="material-icons">expand_more</i>
                                </a>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                favoritosContainer.insertAdjacentHTML('beforeend', cardHTML);
            });
        } catch (error) {
            console.error("Erro ao carregar filmes favoritos:", error);
        }
        }
        
        document.getElementById("selecionarGenero").addEventListener("change", () => {
        carregarFilmesPorGenero(); // üîπ S√≥ faz a requisi√ß√£o quando o g√™nero for selecionado
        });
        async function carregarFilmesPorGenero() {
        const generoSelecionado = document.getElementById("selecionarGenero").value;

        try {
            const response = await fetch("/filmes-por-genero", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ genero: generoSelecionado,user_id: usuarioId }) // üîπ Envia o g√™nero selecionado para o backend
            });

            const filmesFiltrados = await response.json();
            console.log("Filmes carregados por g√™nero:", filmesFiltrados);

            const categoriaContainer = document.getElementById("categoria-tab");
            categoriaContainer.innerHTML = ""; // Limpa a aba antes de exibir os filmes

            filmesFiltrados.forEach(filme => {
                const caminhoClassificacao = carregarClassificacao(filme.Classifica√ß√£o);
                const cardHTML = `
                   <div class="col s2">
                        <div class="card hoverable" data-id="${filme.idFilme}">
                            <div class="card-image">
                                <img src="${filme.imagem}" alt="${filme.nomeFilme}">
                                <button class="btn-fav btn-floating halfway-fab waves-effect waves-light red" data-id="${filme.idFilme}">
                                    <i class="material-icons">${filme.isFavorito ? 'favorite' : 'favorite_border'}</i>
                                </button>
                                <i class="classificacao-indicativa" style="background-image: url('${caminhoClassificacao}');"></i>
                            </div>
                            <div class="card-content">
                                <span class="card-title">${filme.nomeFilme || 'T√≠tulo n√£o encontrado'}</span>
                                <p class="valign-wrapper">
                                    <i class="material-icons amber-text">star</i> ${filme.nota || 'N/A'}
                                </p>
                                <p class="valign-wrapper">
                                    <i class="material-icons">calendar_today</i> ${filme.AnoLanc || 'Ano n√£o dispon√≠vel'}
                                </p>
                                <div class="expand-container">
                                <a class="btn-floating waves-effect waves-light blue expand-btn" onclick='openModal(${filme.idFilme})'>
                                    <i class="material-icons">expand_more</i>
                                </a>
                                </div>
                            </div>
                        </div>
                    </div>
            `;
                categoriaContainer.insertAdjacentHTML('beforeend', cardHTML);
            });
    } catch (error) {
        console.error("Erro ao carregar filmes por g√™nero:", error);
    }
    }
        // Fun√ß√£o para rolar a row para esquerda ou direita
        function scrollSlider(sliderId, direction) {
        const slider = document.getElementById(sliderId);
        const scrollAmount = 300; // Define a dist√¢ncia para mover horizontalmente

        // Verifica se o slider existe
        if (!slider) {
            console.error(`Erro: O slider com ID "${sliderId}" n√£o foi encontrado.`);
            return;
        }

        // Verifica a dire√ß√£o e aplica o movimento
        if (direction === 'left') {
            slider.scrollLeft -= scrollAmount; // Move para a esquerda
        } else if (direction === 'right') {
            slider.scrollLeft += scrollAmount; // Move para a direita
        }
       }
       
       async function openModal(filmeId) {
            if (!filmeId || isNaN(filmeId)) {
            console.error("‚ùå Erro: ID do filme inv√°lido!", filmeId);
            return;
            }



            try {
                const response = await fetch(`/filme/${filmeId}`);
                if (!response.ok) {
                    throw new Error("Erro ao buscar os detalhes do filme!");
                }

                const filme = await response.json();

                const modal = document.getElementById("modal");
                modal.style.display = "flex";
                modal.setAttribute("data-id", filme.idFilme);

                console.log("‚úÖ Dados do filme carregados com sucesso!");
                const caminhoClassificacao = carregarClassificacao(filme.Classifica√ß√£o);
                document.getElementById('modal-rating').style.backgroundImage = `url('${caminhoClassificacao}')`;
                document.getElementById('modal-rating').classList.add("classificacao-indicativa");
                document.getElementById("modal-title").innerText = filme.nomeFilme || "T√≠tulo n√£o encontrado";
                document.getElementById("modal-description").innerText = filme.Sinopse || "Sinopse n√£o dispon√≠vel";
                document.getElementById("modal-year").innerText = filme.AnoLanc || "Ano n√£o dispon√≠vel";
                document.getElementById("modal-genres").innerText = filme.Categoria || "G√™neros n√£o informados";
                
            
                let trailerUrl = filme.Trailer || '';
                if (trailerUrl.includes('watch?v=')) {
                    trailerUrl = trailerUrl.replace('watch?v=', 'embed/') + '?autoplay=1';
                }
                document.getElementById('modal-trailer').src = trailerUrl;
            } catch (error) {
                console.error("‚ùå Erro ao buscar os dados do filme:", error);
            }
        }

        function closeModal() {
        const modal = document.getElementById('modal');
        modal.style.display = 'none'; 
        document.getElementById('modal-trailer').src = "";
        }

        document.addEventListener("click", async e => {
            const btnDelete = e.target.closest(".btn-delete");

            if (btnDelete) {
                const modal = document.getElementById("modal"); // üîπ Agora buscamos o ID do modal
                const filmeId = modal.getAttribute("data-id"); // üîπ Obt√©m o ID do filme diretamente do `modal-content`

                console.log("üóëÔ∏è Filme a deletar:", filmeId);

                if (!filmeId || filmeId === "null") {
                    console.error("‚ùå Erro: ID do filme inv√°lido!");
                    return;
                }

                try {
                    const response = await fetch(`/deletarFilme/${filmeId}`, {
                        method: "DELETE"
                    });

                    if (response.ok) {
                        console.log(`‚úÖ Filme ${filmeId} deletado com sucesso!`);
                        closeModal(); // üîπ Fecha o modal

                        // üîπ Remove **todos** os cards do filme na p√°gina
                        const cards = document.querySelectorAll(`.card.hoverable[data-id="${filmeId}"]`);
                        if (cards.length > 0) {
                            cards.forEach(card => card.remove()); // üîπ Agora remove todos os cards do mesmo filme
                            console.log(`üóëÔ∏è Todos os cards do filme ${filmeId} foram removidos!`);
                        } else {
                            console.error(`‚ùå Erro: Nenhum card do filme ${filmeId} encontrado no DOM!`);
                        }
                    } else {
                        console.error("‚ùå Erro ao deletar filme.");
                    }
                } catch (error) {
                    console.error("‚ùå Erro na requisi√ß√£o:", error);
                }
            }
        });
            
            document.addEventListener("click", e => {
            const btnEdit = e.target.closest("#btn-edit");
            if (btnEdit) {
                console.log("üñäÔ∏è Bot√£o Editar clicado!"); // üîπ Verifique se o clique est√° funcionando

                const editContainer = document.getElementById("edit-container");

                if (editContainer) {
                    editContainer.style.display = "flex"; // üîπ Exibe corretamente o container de edi√ß√£o
                    console.log("‚úèÔ∏è Modo de edi√ß√£o ativado!");

                    // üîπ Preenche os campos com os dados atuais do filme
                    document.getElementById("edit-title").value = document.getElementById("modal-title").innerText;
                    document.getElementById("edit-year").value = document.getElementById("modal-year").innerText;
                    document.getElementById("edit-genres").value = document.getElementById("modal-genres").innerText;
                    document.getElementById("edit-description").value = document.getElementById("modal-description").innerText;
                } else {
                    console.error("‚ùå Erro: `edit-container` n√£o foi encontrado!");
                }
            }
            });
            document.getElementById("cancel-edit").addEventListener("click", () => {
            document.getElementById("edit-container").style.display = "none"; // üîπ Esconde a edi√ß√£o
            });
            document.getElementById("save-edit").addEventListener("click", async () => {
                console.log("üìù Bot√£o salvar foi clicado!");

                const modal = document.getElementById("modal");
                const filmeId = modal.getAttribute("data-id");

                if (!filmeId) {
                    console.error("‚ùå Erro: ID do filme n√£o encontrado!");
                    return;
                }

                // üîπ Captura os elementos do formul√°rio, sem `edit-rating`
                const editTitle = document.getElementById("edit-title");
                const editYear = document.getElementById("edit-year");
                const editGenres = document.getElementById("edit-genres");
                const editDescription = document.getElementById("edit-description");

                if (!editTitle || !editYear || !editGenres || !editDescription) {
                    console.error("‚ùå Erro: Um ou mais campos do formul√°rio de edi√ß√£o n√£o foram encontrados no DOM!");
                    return;
                }

                console.log("üé¨ T√≠tulo:", editTitle.value);
                console.log("üìÖ Ano:", editYear.value);
                console.log("üé≠ G√™nero:", editGenres.value);
                console.log("üìú Sinopse:", editDescription.value);

                const updatedFilme = {
                    nomeFilme: editTitle.value,
                    AnoLanc: editYear.value,
                    Categoria: editGenres.value,
                    Sinopse: editDescription.value
                };

                try {
                    const response = await fetch(`/editarFilme/${filmeId}`, {
                        method: "PUT",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(updatedFilme)
                    });

                    if (response.ok) {
                        console.log(`‚úÖ Filme ${filmeId} atualizado com sucesso!`);

                        modal.querySelector("#modal-title").innerText = updatedFilme.nomeFilme;
                        modal.querySelector("#modal-year").innerText = updatedFilme.AnoLanc;
                        modal.querySelector("#modal-genres").innerText = updatedFilme.Categoria;
                        modal.querySelector("#modal-description").innerText = updatedFilme.Sinopse;

                        document.querySelectorAll(`.card.hoverable[data-id="${filmeId}"]`).forEach(card => {
                            card.querySelector(".card-title").innerText = updatedFilme.nomeFilme;
                            card.querySelector(".valign-wrapper:last-of-type i").nextSibling.textContent = updatedFilme.AnoLanc;
                        });

                        modal.querySelector("#edit-container").style.display = "none";
                    } else {
                        console.error("‚ùå Erro ao editar filme.");
                    }
                } catch (error) {
                    console.error("‚ùå Erro na requisi√ß√£o:", error);
                }
            });
                    // LOGICA PAARA FAVORITAR E DESFAVORITAR
        document.addEventListener("click", async e => {
        if (e.target.closest(".btn-fav")) {
            const btn = e.target.closest(".btn-fav");
            const icon = btn.querySelector("i");
            const filmeId = btn.getAttribute("data-id"); // ID do filme
            const usuarioId = localStorage.getItem("usuarioId");

            const isFavorito = icon.innerHTML === "favorite";
            icon.innerHTML = isFavorito ? "favorite_border" : "favorite";

            // Sincroniza todos os bot√µes com o mesmo ID
            document.querySelectorAll(`.btn-fav[data-id="${filmeId}"] i`).forEach(otherIcon => {
                otherIcon.innerHTML = icon.innerHTML;
            });
        
            // Envia ao backend
            try {
                if (!usuarioId) {
                console.error("Usu√°rio n√£o logado ou ID n√£o dispon√≠vel.");
                alert("Por favor, fa√ßa login antes de favoritar filmes.");
                return;
            }
                const response = await fetch("http://localhost:5000/favoritar", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ filmeId, usuarioId }) // üîπ Envia tamb√©m o usuarioId
                });

                const data = await response.json();
                console.log(data.message);
                
            } catch (error) {
                console.error("Erro ao favoritar:", error);
            }
        }
        });
    
    window.onload = async function() {
    await carregarFilmes();  // üîπ Primeiro, carrega os filmes

    setTimeout(async () => { 
        const usuarioId = localStorage.getItem("usuarioId");

        if (!usuarioId) {
            console.error("Usu√°rio n√£o logado ou ID n√£o dispon√≠vel.");
            alert("Voc√™ precisa estar logado para acessar seus favoritos!");
            window.location.href = "/login";
            return;
        }

        try {
            const response = await fetch("/meus-favoritos", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ usuarioId })
            });

            const favoritos = await response.json();
            console.log("Filmes favoritados recebidos:", favoritos);

            document.querySelectorAll(".btn-fav").forEach(btn => {
                const filmeId = btn.getAttribute("data-id");

                if (favoritos.map(String).includes(filmeId)) { 
                    const icon = btn.querySelector("i");
                    icon.innerHTML = "favorite"; //  Marca visualmente como favorito
                }
            });
        } catch (error) {
            console.error("Erro ao carregar favoritos:", error);
        }
    }, 500);
};
        document.getElementById("search-btn").addEventListener("click", function(event) {
            event.preventDefault(); // üîπ Evita bugs

            const searchInput = document.getElementById("search-input");
            const searchBtn = document.getElementById("search-btn");

            if (searchInput.style.display === "none") {
                searchInput.style.display = "block"; // üîπ Faz o input aparecer
                searchBtn.style.transform = "translateX(-20px)"; // üîπ Move a lupa para a esquerda
                searchInput.focus(); // üîπ Foca no input ao expandir
            } else {
                searchInput.style.display = "none"; // üîπ Oculta novamente ao clicar
                searchBtn.style.transform = "translateX(0)"; // üîπ Retorna o bot√£o para a posi√ß√£o original
            }
        });

        let buscaTimeout; // üîπ Vari√°vel global para controlar o tempo entre buscas

        document.getElementById("search-input").addEventListener("input", function() {
            clearTimeout(buscaTimeout); // üîπ Cancela a execu√ß√£o anterior para evitar sobrecarga

            buscaTimeout = setTimeout(async function() {
                const searchTerm = document.getElementById("search-input").value.toLowerCase();
                const resultadoContainer = document.getElementById("filmes-encontrados");

                resultadoContainer.innerHTML = ""; // üîπ Limpa resultados para evitar repeti√ß√£o

                if (searchTerm === "") {
                    document.querySelectorAll(".row-container").forEach(row => row.style.display = "block");
                    document.getElementById("resultado-pesquisa").style.display = "none";
                    return;
                }

                document.querySelectorAll(".row-container").forEach(row => row.style.display = "none");
                document.getElementById("resultado-pesquisa").style.display = "block";
                const response = await fetch(`/buscar_filmes?q=${encodeURIComponent(searchTerm)}&user_id=${usuarioId}`);  
                const termoBuscaSpan = document.getElementById("termo-busca"); // üîπ Elemento dentro das aspas

                // üîπ Atualiza o conte√∫do do <span> dentro do <h3>
                termoBuscaSpan.textContent = searchTerm !== "" ? searchTerm : "...";

                const filmes = await response.json();  

                const idsFilmesAdicionados = new Set(); // üîπ Conjunto para rastrear quais IDs j√° foram inseridos  

                filmes.forEach(filme => {  
                    if (!idsFilmesAdicionados.has(filme.idFilme)) { // üîπ Verifica se o filme j√° foi adicionado  
                        idsFilmesAdicionados.add(filme.idFilme); // üîπ Adiciona ao conjunto para evitar repeti√ß√£o  

                        const caminhoClassificacao = carregarClassificacao(filme.Classifica√ß√£o);  

                        const cardHTML = `  
                            <div class="col s2">  
                                <div class="card hoverable" data-id="${filme.idFilme}">  
                                    <div class="card-image">  
                                        <img src="${filme.imagem}" alt="${filme.nomeFilme}">  
                                        <button class="btn-fav btn-floating halfway-fab waves-effect waves-light red" data-id="${filme.idFilme}">  
                                            <i class="material-icons">${filme.isFavorito ? 'favorite' : 'favorite_border'}</i>  
                                        </button>  
                                        <i class="classificacao-indicativa" style="background-image: url('${caminhoClassificacao}');"></i>  
                                    </div>  
                                    <div class="card-content">  
                                        <span class="card-title">${filme.nomeFilme || 'T√≠tulo n√£o encontrado'}</span>  
                                        <p class="valign-wrapper">  
                                            <i class="material-icons amber-text">star</i> ${filme.nota || 'N/A'}  
                                        </p>  
                                        <p class="valign-wrapper">  
                                            <i class="material-icons">calendar_today</i> ${filme.AnoLanc || 'Ano n√£o dispon√≠vel'}  
                                        </p>  
                                        <div class="expand-container">  
                                            <a class="btn-floating waves-effect waves-light blue expand-btn" onclick='openModal(${filme.idFilme})'>  
                                                <i class="material-icons">expand_more</i>  
                                            </a>  
                                        </div>  
                                    </div>  
                                </div>  
                            </div>  
                        `;  

                        resultadoContainer.insertAdjacentHTML('beforeend', cardHTML);  
                    }  
                });
            }, 300); // üîπ Aguarda 300ms antes de executar a busca, evitando chamadas excessivas
            });
            document.querySelector('a[href="/"]').addEventListener("click", function(event) {
            event.preventDefault(); // üîπ Impede que o link execute imediatamente
            localStorage.removeItem("usuarioId"); // üîπ Remove o ID do usu√°rio do armazenamento
            window.location.href = "/"; // üîπ Redireciona para a p√°gina de login
         });

    </script>


</body>
</html>